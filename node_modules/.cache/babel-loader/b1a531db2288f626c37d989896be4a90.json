{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CacheInterceptor = void 0;\n\nconst tslib_1 = require(\"tslib\");\n\nconst rxjs_1 = require(\"rxjs\");\n\nconst operators_1 = require(\"rxjs/operators\");\n\nconst decorators_1 = require(\"../../decorators\");\n\nconst logger_service_1 = require(\"../../services/logger.service\");\n\nconst shared_utils_1 = require(\"../../utils/shared.utils\");\n\nconst cache_constants_1 = require(\"../cache.constants\");\n\nconst HTTP_ADAPTER_HOST = 'HttpAdapterHost';\nconst REFLECTOR = 'Reflector';\nlet CacheInterceptor = class CacheInterceptor {\n  constructor(cacheManager, reflector) {\n    this.cacheManager = cacheManager;\n    this.reflector = reflector;\n    this.allowedMethods = ['GET'];\n  }\n\n  async intercept(context, next) {\n    var _a;\n\n    const key = this.trackBy(context);\n    const ttlValueOrFactory = (_a = this.reflector.get(cache_constants_1.CACHE_TTL_METADATA, context.getHandler())) !== null && _a !== void 0 ? _a : null;\n\n    if (!key) {\n      return next.handle();\n    }\n\n    try {\n      const value = await this.cacheManager.get(key);\n\n      if (!(0, shared_utils_1.isNil)(value)) {\n        return (0, rxjs_1.of)(value);\n      }\n\n      const ttl = (0, shared_utils_1.isFunction)(ttlValueOrFactory) ? await ttlValueOrFactory(context) : ttlValueOrFactory;\n      return next.handle().pipe((0, operators_1.tap)(async response => {\n        const args = (0, shared_utils_1.isNil)(ttl) ? [key, response] : [key, response, {\n          ttl\n        }];\n\n        try {\n          await this.cacheManager.set(...args);\n        } catch (err) {\n          logger_service_1.Logger.error(`An error has occured when inserting \"key: ${key}\", \"value: ${response}\"`, 'CacheInterceptor');\n        }\n      }));\n    } catch (_b) {\n      return next.handle();\n    }\n  }\n\n  trackBy(context) {\n    const httpAdapter = this.httpAdapterHost.httpAdapter;\n    const isHttpApp = httpAdapter && !!httpAdapter.getRequestMethod;\n    const cacheMetadata = this.reflector.get(cache_constants_1.CACHE_KEY_METADATA, context.getHandler());\n\n    if (!isHttpApp || cacheMetadata) {\n      return cacheMetadata;\n    }\n\n    const request = context.getArgByIndex(0);\n\n    if (!this.isRequestCacheable(context)) {\n      return undefined;\n    }\n\n    return httpAdapter.getRequestUrl(request);\n  }\n\n  isRequestCacheable(context) {\n    const req = context.switchToHttp().getRequest();\n    return this.allowedMethods.includes(req.method);\n  }\n\n};\n\ntslib_1.__decorate([(0, decorators_1.Optional)(), (0, decorators_1.Inject)(HTTP_ADAPTER_HOST), tslib_1.__metadata(\"design:type\", Object)], CacheInterceptor.prototype, \"httpAdapterHost\", void 0);\n\nCacheInterceptor = tslib_1.__decorate([(0, decorators_1.Injectable)(), tslib_1.__param(0, (0, decorators_1.Inject)(cache_constants_1.CACHE_MANAGER)), tslib_1.__param(1, (0, decorators_1.Inject)(REFLECTOR)), tslib_1.__metadata(\"design:paramtypes\", [Object, Object])], CacheInterceptor);\nexports.CacheInterceptor = CacheInterceptor;","map":{"version":3,"names":["Object","defineProperty","exports","value","CacheInterceptor","tslib_1","require","rxjs_1","operators_1","decorators_1","logger_service_1","shared_utils_1","cache_constants_1","HTTP_ADAPTER_HOST","REFLECTOR","constructor","cacheManager","reflector","allowedMethods","intercept","context","next","_a","key","trackBy","ttlValueOrFactory","get","CACHE_TTL_METADATA","getHandler","handle","isNil","of","ttl","isFunction","pipe","tap","response","args","set","err","Logger","error","_b","httpAdapter","httpAdapterHost","isHttpApp","getRequestMethod","cacheMetadata","CACHE_KEY_METADATA","request","getArgByIndex","isRequestCacheable","undefined","getRequestUrl","req","switchToHttp","getRequest","includes","method","__decorate","Optional","Inject","__metadata","prototype","Injectable","__param","CACHE_MANAGER"],"sources":["C:/Users/Admin/Desktop/NikeShoes/node_modules/@nestjs/common/cache/interceptors/cache.interceptor.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CacheInterceptor = void 0;\nconst tslib_1 = require(\"tslib\");\nconst rxjs_1 = require(\"rxjs\");\nconst operators_1 = require(\"rxjs/operators\");\nconst decorators_1 = require(\"../../decorators\");\nconst logger_service_1 = require(\"../../services/logger.service\");\nconst shared_utils_1 = require(\"../../utils/shared.utils\");\nconst cache_constants_1 = require(\"../cache.constants\");\nconst HTTP_ADAPTER_HOST = 'HttpAdapterHost';\nconst REFLECTOR = 'Reflector';\nlet CacheInterceptor = class CacheInterceptor {\n    constructor(cacheManager, reflector) {\n        this.cacheManager = cacheManager;\n        this.reflector = reflector;\n        this.allowedMethods = ['GET'];\n    }\n    async intercept(context, next) {\n        var _a;\n        const key = this.trackBy(context);\n        const ttlValueOrFactory = (_a = this.reflector.get(cache_constants_1.CACHE_TTL_METADATA, context.getHandler())) !== null && _a !== void 0 ? _a : null;\n        if (!key) {\n            return next.handle();\n        }\n        try {\n            const value = await this.cacheManager.get(key);\n            if (!(0, shared_utils_1.isNil)(value)) {\n                return (0, rxjs_1.of)(value);\n            }\n            const ttl = (0, shared_utils_1.isFunction)(ttlValueOrFactory)\n                ? await ttlValueOrFactory(context)\n                : ttlValueOrFactory;\n            return next.handle().pipe((0, operators_1.tap)(async (response) => {\n                const args = (0, shared_utils_1.isNil)(ttl) ? [key, response] : [key, response, { ttl }];\n                try {\n                    await this.cacheManager.set(...args);\n                }\n                catch (err) {\n                    logger_service_1.Logger.error(`An error has occured when inserting \"key: ${key}\", \"value: ${response}\"`, 'CacheInterceptor');\n                }\n            }));\n        }\n        catch (_b) {\n            return next.handle();\n        }\n    }\n    trackBy(context) {\n        const httpAdapter = this.httpAdapterHost.httpAdapter;\n        const isHttpApp = httpAdapter && !!httpAdapter.getRequestMethod;\n        const cacheMetadata = this.reflector.get(cache_constants_1.CACHE_KEY_METADATA, context.getHandler());\n        if (!isHttpApp || cacheMetadata) {\n            return cacheMetadata;\n        }\n        const request = context.getArgByIndex(0);\n        if (!this.isRequestCacheable(context)) {\n            return undefined;\n        }\n        return httpAdapter.getRequestUrl(request);\n    }\n    isRequestCacheable(context) {\n        const req = context.switchToHttp().getRequest();\n        return this.allowedMethods.includes(req.method);\n    }\n};\ntslib_1.__decorate([\n    (0, decorators_1.Optional)(),\n    (0, decorators_1.Inject)(HTTP_ADAPTER_HOST),\n    tslib_1.__metadata(\"design:type\", Object)\n], CacheInterceptor.prototype, \"httpAdapterHost\", void 0);\nCacheInterceptor = tslib_1.__decorate([\n    (0, decorators_1.Injectable)(),\n    tslib_1.__param(0, (0, decorators_1.Inject)(cache_constants_1.CACHE_MANAGER)),\n    tslib_1.__param(1, (0, decorators_1.Inject)(REFLECTOR)),\n    tslib_1.__metadata(\"design:paramtypes\", [Object, Object])\n], CacheInterceptor);\nexports.CacheInterceptor = CacheInterceptor;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}